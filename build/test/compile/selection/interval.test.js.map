{"version":3,"file":"interval.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/interval.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\n\nimport {assert} from 'chai';\nimport {selector as parseSelector} from 'vega-event-selector';\n\nimport interval from '../../../src/compile/selection/interval';\nimport * as selection from '../../../src/compile/selection/selection';\nimport {parseUnitModel} from '../../util';\n\ndescribe('Interval Selections', function() {\n  const model = parseUnitModel({\n    \"mark\": \"circle\",\n    \"encoding\": {\n      \"x\": {\"field\": \"Horsepower\",\"type\": \"quantitative\"},\n      \"y\": {\"field\": \"Miles-per-Gallon\",\"type\": \"quantitative\"},\n      \"color\": {\"field\": \"Origin\", \"type\": \"nominal\"}\n    }\n  });\n  model.parseScale();\n\n  const selCmpts = model.component.selection = selection.parseUnitSelection(model, {\n    \"one\": {\"type\": \"interval\", \"encodings\": [\"x\"], \"translate\": false, \"zoom\": false},\n    \"two\": {\n      \"type\": \"interval\",\n      \"encodings\": [\"y\"],\n      \"bind\": \"scales\",\n      \"translate\": false,\n      \"zoom\": false\n    },\n    \"thr-ee\": {\n      \"type\": \"interval\",\n      \"on\": \"[mousedown, mouseup] > mousemove, [keydown, keyup] > keypress\",\n      \"translate\": false,\n      \"zoom\": false,\n      \"resolve\": \"intersect\",\n      \"mark\": {\n        \"fill\": \"red\",\n        \"fillOpacity\": 0.75,\n        \"stroke\": \"black\",\n        \"strokeWidth\": 4,\n        \"strokeDash\": [10, 5],\n        \"strokeDashOffset\": 3,\n        \"strokeOpacity\": 0.25\n      }\n    }\n  });\n\n  describe('Tuple Signals', function() {\n    it('builds projection signals', function() {\n      const oneSg = interval.signals(model, selCmpts['one']);\n      assert.includeDeepMembers(oneSg, [{\n        \"name\": \"one_x\",\n        \"value\": [],\n        \"on\": [\n          {\n            \"events\": parseSelector('mousedown', 'scope')[0],\n            \"update\": \"[x(unit), x(unit)]\"\n          },\n          {\n            \"events\": parseSelector('[mousedown, window:mouseup] > window:mousemove!', 'scope')[0],\n            \"update\": \"[one_x[0], clamp(x(unit), 0, width)]\"\n          },\n          {\n            \"events\": {\"signal\": \"one_scale_trigger\"},\n            \"update\": \"[scale(\\\"x\\\", one_Horsepower[0]), scale(\\\"x\\\", one_Horsepower[1])]\"\n          }\n        ]\n      }, {\n        \"name\": \"one_Horsepower\",\n        \"on\": [{\n          \"events\": {\"signal\": \"one_x\"},\n          \"update\": \"one_x[0] === one_x[1] ? null : invert(\\\"x\\\", one_x)\"\n        }]\n      }, {\n        \"name\": \"one_scale_trigger\",\n        \"update\": \"(!isArray(one_Horsepower) || (+invert(\\\"x\\\", one_x)[0] === +one_Horsepower[0] && +invert(\\\"x\\\", one_x)[1] === +one_Horsepower[1])) ? one_scale_trigger : {}\"\n      }]);\n\n      const twoSg = interval.signals(model, selCmpts['two']);\n      assert.includeDeepMembers(twoSg, [{\n        \"name\": \"two_Miles_per_Gallon\",\n        \"on\": []\n      }]);\n\n      const threeSg = interval.signals(model, selCmpts['thr_ee']);\n      assert.includeDeepMembers(threeSg, [\n        {\n          \"name\": \"thr_ee_x\",\n          \"value\": [],\n          \"on\": [\n            {\n              \"events\": parseSelector('mousedown', 'scope')[0],\n              \"update\": \"[x(unit), x(unit)]\"\n            },\n            {\n              \"events\": parseSelector('[mousedown, mouseup] > mousemove', 'scope')[0],\n              \"update\": \"[thr_ee_x[0], clamp(x(unit), 0, width)]\"\n            },\n            {\n              \"events\": parseSelector('keydown', 'scope')[0],\n              \"update\": \"[x(unit), x(unit)]\"\n            },\n            {\n              \"events\": parseSelector('[keydown, keyup] > keypress', 'scope')[0],\n              \"update\": \"[thr_ee_x[0], clamp(x(unit), 0, width)]\"\n            },\n            {\n              \"events\": {\"signal\": \"thr_ee_scale_trigger\"},\n              \"update\": \"[scale(\\\"x\\\", thr_ee_Horsepower[0]), scale(\\\"x\\\", thr_ee_Horsepower[1])]\"\n            }\n          ]\n        },\n        {\n          \"name\": \"thr_ee_Horsepower\",\n          \"on\": [{\n            \"events\": {\"signal\": \"thr_ee_x\"},\n            \"update\": \"thr_ee_x[0] === thr_ee_x[1] ? null : invert(\\\"x\\\", thr_ee_x)\"\n          }]\n        },\n        {\n          \"name\": \"thr_ee_y\",\n          \"value\": [],\n          \"on\": [\n            {\n              \"events\": parseSelector('mousedown', 'scope')[0],\n              \"update\": \"[y(unit), y(unit)]\"\n            },\n            {\n              \"events\": parseSelector('[mousedown, mouseup] > mousemove', 'scope')[0],\n              \"update\": \"[thr_ee_y[0], clamp(y(unit), 0, height)]\"\n            },\n            {\n              \"events\": parseSelector('keydown', 'scope')[0],\n              \"update\": \"[y(unit), y(unit)]\"\n            },\n            {\n              \"events\": parseSelector('[keydown, keyup] > keypress', 'scope')[0],\n              \"update\": \"[thr_ee_y[0], clamp(y(unit), 0, height)]\"\n            },\n            {\n              \"events\": {\"signal\": \"thr_ee_scale_trigger\"},\n              \"update\": \"[scale(\\\"y\\\", thr_ee_Miles_per_Gallon[0]), scale(\\\"y\\\", thr_ee_Miles_per_Gallon[1])]\"\n            }\n          ]\n        },\n        {\n          \"name\": \"thr_ee_Miles_per_Gallon\",\n          \"on\": [{\n            \"events\": {\"signal\": \"thr_ee_y\"},\n            \"update\": \"thr_ee_y[0] === thr_ee_y[1] ? null : invert(\\\"y\\\", thr_ee_y)\"\n          }]\n        },\n        {\n          \"name\": \"thr_ee_scale_trigger\",\n          \"update\": \"(!isArray(thr_ee_Horsepower) || (+invert(\\\"x\\\", thr_ee_x)[0] === +thr_ee_Horsepower[0] && +invert(\\\"x\\\", thr_ee_x)[1] === +thr_ee_Horsepower[1])) && (!isArray(thr_ee_Miles_per_Gallon) || (+invert(\\\"y\\\", thr_ee_y)[0] === +thr_ee_Miles_per_Gallon[0] && +invert(\\\"y\\\", thr_ee_y)[1] === +thr_ee_Miles_per_Gallon[1])) ? thr_ee_scale_trigger : {}\"\n        }\n      ]);\n    });\n\n    it('builds trigger signals', function() {\n      const oneSg = interval.signals(model, selCmpts['one']);\n      assert.includeDeepMembers(oneSg, [\n        {\n          \"name\": \"one_tuple\",\n          \"on\": [{\n            \"events\": [{\"signal\": \"one_Horsepower\"}],\n            \"update\": \"one_Horsepower ? {unit: \\\"\\\", intervals: [{encoding: \\\"x\\\", field: \\\"Horsepower\\\", extent: one_Horsepower}]} : null\"\n          }]\n        }\n      ]);\n\n      const twoSg = interval.signals(model, selCmpts['two']);\n      assert.includeDeepMembers(twoSg, [\n        {\n          \"name\": \"two_tuple\",\n          \"on\": [{\n            \"events\": [{\"signal\": \"two_Miles_per_Gallon\"}],\n            \"update\": \"two_Miles_per_Gallon ? {unit: \\\"\\\", intervals: [{encoding: \\\"y\\\", field: \\\"Miles-per-Gallon\\\", extent: two_Miles_per_Gallon}]} : null\"\n          }]\n        }\n      ]);\n\n      const threeSg = interval.signals(model, selCmpts['thr_ee']);\n      assert.includeDeepMembers(threeSg, [\n        {\n          \"name\": \"thr_ee_tuple\",\n          \"on\": [{\n            \"events\": [{\"signal\": \"thr_ee_Horsepower\"}, {\"signal\": \"thr_ee_Miles_per_Gallon\"}],\n            \"update\": \"thr_ee_Horsepower && thr_ee_Miles_per_Gallon ? {unit: \\\"\\\", intervals: [{encoding: \\\"x\\\", field: \\\"Horsepower\\\", extent: thr_ee_Horsepower}, {encoding: \\\"y\\\", field: \\\"Miles-per-Gallon\\\", extent: thr_ee_Miles_per_Gallon}]} : null\"\n          }]\n        }\n      ]);\n    });\n\n    it('namespaces signals when encoding/fields collide', function() {\n      const model2 = parseUnitModel({\n        \"mark\": \"circle\",\n        \"encoding\": {\n          \"x\": {\"field\": \"x\", \"type\": \"quantitative\"},\n          \"y\": {\"field\": \"y\", \"type\": \"quantitative\"}\n        }\n      });\n\n      const selCmpts2 = model2.component.selection = selection.parseUnitSelection(model2, {\n        \"one\": {\n          \"type\": \"interval\",\n          \"encodings\": [\"x\"],\n          \"translate\": false, \"zoom\": false\n        }\n      });\n\n      const sg = interval.signals(model, selCmpts2['one']);\n      assert.equal(sg[0].name, 'one_x');\n      assert.equal(sg[1].name, 'one_x_1');\n    });\n  });\n\n  it('builds modify signals', function() {\n    const oneExpr = interval.modifyExpr(model, selCmpts['one']);\n    assert.equal(oneExpr, 'one_tuple, true');\n\n    const twoExpr = interval.modifyExpr(model, selCmpts['two']);\n    assert.equal(twoExpr, 'two_tuple, true');\n\n    const threeExpr = interval.modifyExpr(model, selCmpts['thr_ee']);\n    assert.equal(threeExpr, 'thr_ee_tuple, {unit: \\\"\\\"}');\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    assert.includeDeepMembers(signals, [\n      {\n        \"name\": \"one_modify\",\n        \"on\": [\n          {\n            \"events\": {\"signal\": \"one_tuple\"},\n            \"update\": `modify(\\\"one_store\\\", ${oneExpr})`\n          }\n        ]\n      },\n      {\n        \"name\": \"two_modify\",\n        \"on\": [\n          {\n            \"events\": {\"signal\": \"two_tuple\"},\n            \"update\": `modify(\\\"two_store\\\", ${twoExpr})`\n          }\n        ]\n      },\n      {\n        \"name\": \"thr_ee_modify\",\n        \"on\": [\n          {\n            \"events\": {\"signal\": \"thr_ee_tuple\"},\n            \"update\": `modify(\\\"thr_ee_store\\\", ${threeExpr})`\n          }\n        ]\n      }\n    ]);\n  });\n\n  it('builds brush mark', function() {\n    const marks: any[] = [{hello: \"world\"}];\n    assert.sameDeepMembers(interval.marks(model, selCmpts['one'], marks), [\n      {\n        \"name\": \"one_brush_bg\",\n        \"type\": \"rect\",\n        \"clip\": true,\n        \"encode\": {\n          \"enter\": {\n            \"fill\": {\"value\": \"#333\"},\n            \"fillOpacity\": {\"value\": 0.125}\n          },\n          \"update\": {\n            \"x\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"signal\": \"one_x[0]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"value\": 0\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"x2\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"signal\": \"one_x[1]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y2\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"field\": {\n                  \"group\": \"height\"\n                }\n              },\n              {\n                \"value\": 0\n              }\n            ]\n          }\n        }\n      },\n      {\"hello\": \"world\"},\n      {\n        \"name\": \"one_brush\",\n        \"type\": \"rect\",\n        \"clip\": true,\n        \"encode\": {\n          \"enter\": {\n            \"fill\": {\"value\": \"transparent\"}\n          },\n          \"update\": {\n            \"stroke\": [\n              {\n                \"test\": \"one_x[0] !== one_x[1]\",\n                \"value\": \"white\"\n              },\n              {\n                \"value\": null\n              }\n            ],\n            \"x\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"signal\": \"one_x[0]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"value\": 0\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"x2\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"signal\": \"one_x[1]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y2\": [\n              {\n                \"test\": \"data(\\\"one_store\\\").length && data(\\\"one_store\\\")[0].unit === \\\"\\\"\",\n                \"field\": {\n                  \"group\": \"height\"\n                }\n              },\n              {\n                \"value\": 0\n              }\n            ]\n          }\n        }\n      }\n    ]);\n\n    // Scale-bound interval selections should not add a brush mark.\n    assert.sameDeepMembers(interval.marks(model, selCmpts['two'], marks), marks);\n\n    assert.sameDeepMembers(interval.marks(model, selCmpts['thr_ee'], marks), [\n      {\n        \"name\": \"thr_ee_brush_bg\",\n        \"type\": \"rect\",\n        \"clip\": true,\n        \"encode\": {\n          \"enter\": {\n            \"fill\": {\"value\": \"red\"},\n            \"fillOpacity\": {\"value\": 0.75}\n          },\n          \"update\": {\n            \"x\": {\n              \"signal\": \"thr_ee_x[0]\"\n            },\n            \"y\": {\n              \"signal\": \"thr_ee_y[0]\"\n            },\n            \"x2\": {\n              \"signal\": \"thr_ee_x[1]\"\n            },\n            \"y2\": {\n              \"signal\": \"thr_ee_y[1]\"\n            }\n          }\n        }\n      },\n      {\"hello\": \"world\"},\n      {\n        \"name\": \"thr_ee_brush\",\n        \"type\": \"rect\",\n        \"clip\": true,\n        \"encode\": {\n          \"enter\": {\n            \"fill\": {\"value\": \"transparent\"}\n          },\n          \"update\": {\n            \"stroke\": [\n              {\n                \"test\": \"thr_ee_x[0] !== thr_ee_x[1] && thr_ee_y[0] !== thr_ee_y[1]\",\n                \"value\": \"black\"\n              },\n              {\"value\": null}\n            ],\n            \"strokeWidth\": [\n              {\n                \"test\": \"thr_ee_x[0] !== thr_ee_x[1] && thr_ee_y[0] !== thr_ee_y[1]\",\n                \"value\": 4\n              },\n              {\"value\": null}\n            ],\n            \"strokeDash\": [\n              {\n                \"test\": \"thr_ee_x[0] !== thr_ee_x[1] && thr_ee_y[0] !== thr_ee_y[1]\",\n                \"value\": [10, 5]\n              },\n              {\"value\": null}\n            ],\n            \"strokeDashOffset\": [\n              {\n                \"test\": \"thr_ee_x[0] !== thr_ee_x[1] && thr_ee_y[0] !== thr_ee_y[1]\",\n                \"value\": 3\n              },\n              {\"value\": null}\n            ],\n            \"strokeOpacity\": [\n              {\n                \"test\": \"thr_ee_x[0] !== thr_ee_x[1] && thr_ee_y[0] !== thr_ee_y[1]\",\n                \"value\": 0.25\n              },\n              {\"value\": null}\n            ],\n            \"x\": {\n              \"signal\": \"thr_ee_x[0]\"\n            },\n            \"y\": {\n              \"signal\": \"thr_ee_y[0]\"\n            },\n            \"x2\": {\n              \"signal\": \"thr_ee_x[1]\"\n            },\n            \"y2\": {\n              \"signal\": \"thr_ee_y[1]\"\n            }\n          }\n        }\n      }\n    ]);\n  });\n});\n"]}