{"version":3,"file":"layers.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/layers.test.ts"],"names":[],"mappings":"AAAA,8BAA8B;;AAE9B,OAAO,EAAC,MAAM,EAAC,MAAM,MAAM,CAAC;AAC5B,OAAO,KAAK,SAAS,MAAM,0CAA0C,CAAC;AAEtE,OAAO,EAAC,eAAe,EAAC,MAAM,YAAY,CAAC;AAE3C,QAAQ,CAAC,oBAAoB,EAAE;IAC7B,IAAM,MAAM,GAAG,eAAe,CAAC;QAC7B,KAAK,EAAE,CAAC;gBACN,WAAW,EAAE;oBACX,OAAO,EAAE,EAAC,MAAM,EAAE,UAAU,EAAC;iBAC9B;gBACD,MAAM,EAAE,QAAQ;gBAChB,UAAU,EAAE;oBACV,GAAG,EAAE,EAAC,OAAO,EAAE,YAAY,EAAC,MAAM,EAAE,cAAc,EAAC;oBACnD,GAAG,EAAE,EAAC,OAAO,EAAE,kBAAkB,EAAC,MAAM,EAAE,cAAc,EAAC;oBACzD,OAAO,EAAE,EAAC,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAC;iBAChD;aACF,EAAE;gBACD,WAAW,EAAE;oBACX,MAAM,EAAE,EAAC,MAAM,EAAE,UAAU,EAAE,MAAM,EAAE,QAAQ,EAAC;iBAC/C;gBACD,MAAM,EAAE,QAAQ;gBAChB,UAAU,EAAE;oBACV,GAAG,EAAE,EAAC,OAAO,EAAE,YAAY,EAAC,MAAM,EAAE,cAAc,EAAC;oBACnD,GAAG,EAAE,EAAC,OAAO,EAAE,kBAAkB,EAAC,MAAM,EAAE,cAAc,EAAC;oBACzD,OAAO,EAAE,EAAC,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAC;iBAChD;aACF,CAAC;KACH,CAAC,CAAC;IAEH,MAAM,CAAC,KAAK,EAAE,CAAC;IAEf,EAAE,CAAC,oCAAoC,EAAE;QACvC,IAAM,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAc,CAAC;QAC7C,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,WAAW,CAAC,CAAC;IACtD,CAAC,CAAC,CAAC;IAEH,qEAAqE;IACrE,sEAAsE;IACtE,sEAAsE;IACtE,iBAAiB;IACjB,EAAE,CAAC,wCAAwC,EAAE;QAC3C,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,aAAa,EAAE,EAAE,CAAC;gBAC1D,MAAM,EAAE,eAAe;gBACvB,MAAM,EAAE,QAAQ;gBAChB,OAAO,EAAE,CAAC,QAAQ,CAAC;gBACnB,MAAM,EAAE;oBACN,MAAM,EAAE,cAAc;iBACvB;gBACD,MAAM,EAAE,IAAI;gBACZ,QAAQ,EAAE;oBACR,QAAQ,EAAE;wBACR,GAAG,EAAE;4BACH,OAAO,EAAE,GAAG;4BACZ,OAAO,EAAE,YAAY;yBACtB;wBACD,GAAG,EAAE;4BACH,OAAO,EAAE,GAAG;4BACZ,OAAO,EAAE,kBAAkB;yBAC5B;wBACD,MAAM,EAAE;4BACN,OAAO,EAAE,OAAO;4BAChB,OAAO,EAAE,QAAQ;yBAClB;wBACD,OAAO,EAAE;4BACP,OAAO,EAAE,QAAQ;yBAClB;wBACD,SAAS,EAAE;4BACT,OAAO,EAAE,GAAG;yBACb;qBACF;iBACF;aACF,CAAC,CAAC,CAAC;QAEJ,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,aAAa,EAAE,EAAE,CAAC;gBAC1D,MAAM,EAAE,eAAe;gBACvB,MAAM,EAAE,QAAQ;gBAChB,OAAO,EAAE,CAAC,QAAQ,CAAC;gBACnB,MAAM,EAAE;oBACN,MAAM,EAAE,cAAc;iBACvB;gBACD,MAAM,EAAE,IAAI;gBACZ,QAAQ,EAAE;oBACR,QAAQ,EAAE;wBACR,GAAG,EAAE;4BACH,OAAO,EAAE,GAAG;4BACZ,OAAO,EAAE,YAAY;yBACtB;wBACD,GAAG,EAAE;4BACH,OAAO,EAAE,GAAG;4BACZ,OAAO,EAAE,kBAAkB;yBAC5B;wBACD,MAAM,EAAE;4BACN,OAAO,EAAE,OAAO;4BAChB,OAAO,EAAE,QAAQ;yBAClB;wBACD,OAAO,EAAE;4BACP,OAAO,EAAE,QAAQ;yBAClB;wBACD,SAAS,EAAE;4BACT,OAAO,EAAE,GAAG;yBACb;qBACF;iBACF;aACF,CAAC,CAAC,CAAC;IACN,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,+CAA+C,EAAE;QAClD,IAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC,CAAC;QACrD,IAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC,CAAC;QAErD,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE;YAC7C,+CAA+C;YAC/C;gBACE,MAAM,EAAE,gBAAgB;gBACxB,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,IAAI;gBACZ,QAAQ,EAAE;oBACR,OAAO,EAAE;wBACP,MAAM,EAAE,EAAC,OAAO,EAAE,MAAM,EAAC;wBACzB,aAAa,EAAE,EAAC,OAAO,EAAE,KAAK,EAAC;qBAChC;oBACD,QAAQ,EAAE;wBACR,GAAG,EAAE;4BACH;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;wBACD,GAAG,EAAE;4BACH;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;wBACD,IAAI,EAAE;4BACJ;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;wBACD,IAAI,EAAE;4BACJ;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;qBACF;iBACF;aACF;iCAEG,MAAM,IAAE,IAAI,EAAE,IAAI;iCAAO,MAAM,IAAE,IAAI,EAAE,IAAI;YAC/C,+CAA+C;YAC/C;gBACE,MAAM,EAAE,aAAa;gBACrB,MAAM,EAAE,MAAM;gBACd,MAAM,EAAE,IAAI;gBACZ,QAAQ,EAAE;oBACR,OAAO,EAAE;wBACP,MAAM,EAAE,EAAC,OAAO,EAAE,aAAa,EAAC;qBACjC;oBACD,QAAQ,EAAE;wBACR,QAAQ,EAAE;4BACR;gCACE,MAAM,EAAE,wDAAwD;gCAChE,OAAO,EAAE,OAAO;6BACjB;4BACD,EAAC,OAAO,EAAE,IAAI,EAAC;yBAChB;wBACD,GAAG,EAAE;4BACH;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;wBACD,GAAG,EAAE;4BACH;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;wBACD,IAAI,EAAE;4BACJ;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;wBACD,IAAI,EAAE;4BACJ;gCACE,MAAM,EAAE,+EAA+E;gCACvF,QAAQ,EAAE,YAAY;6BACvB;4BACD;gCACE,OAAO,EAAE,CAAC;6BACX;yBACF;qBACF;iBACF;aACF;SACF,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["/* tslint:disable quotemark */\n\nimport {assert} from 'chai';\nimport * as selection from '../../../src/compile/selection/selection';\nimport {UnitModel} from '../../../src/compile/unit';\nimport {parseLayerModel} from '../../util';\n\ndescribe('Layered Selections', function() {\n  const layers = parseLayerModel({\n    layer: [{\n      \"selection\": {\n        \"brush\": {\"type\": \"interval\"}\n      },\n      \"mark\": \"circle\",\n      \"encoding\": {\n        \"x\": {\"field\": \"Horsepower\",\"type\": \"quantitative\"},\n        \"y\": {\"field\": \"Miles_per_Gallon\",\"type\": \"quantitative\"},\n        \"color\": {\"field\": \"Origin\", \"type\": \"nominal\"}\n      }\n    }, {\n      \"selection\": {\n        \"grid\": {\"type\": \"interval\", \"bind\": \"scales\"}\n      },\n      \"mark\": \"square\",\n      \"encoding\": {\n        \"x\": {\"field\": \"Horsepower\",\"type\": \"quantitative\"},\n        \"y\": {\"field\": \"Miles_per_Gallon\",\"type\": \"quantitative\"},\n        \"color\": {\"field\": \"Origin\", \"type\": \"nominal\"}\n      }\n    }]\n  });\n\n  layers.parse();\n\n  it('should appropriately name the unit', function() {\n    const unit = layers.children[0] as UnitModel;\n    assert.equal(selection.unitName(unit), '\"layer_0\"');\n  });\n\n  // Selections should augment layered marks together, rather than each\n  // mark individually. This ensures correct interleaving of brush marks\n  // (i.e., that the brush mark appears above all layers and thus can be\n  // moved around).\n  it('should pass through unit mark assembly', function() {\n    assert.sameDeepMembers(layers.children[0].assembleMarks(), [{\n      \"name\": \"layer_0_marks\",\n      \"type\": \"symbol\",\n      \"style\": [\"circle\"],\n      \"from\": {\n        \"data\": \"layer_0_main\"\n      },\n      \"clip\": true,\n      \"encode\": {\n        \"update\": {\n          \"x\": {\n            \"scale\": \"x\",\n            \"field\": \"Horsepower\"\n          },\n          \"y\": {\n            \"scale\": \"y\",\n            \"field\": \"Miles_per_Gallon\"\n          },\n          \"fill\": {\n            \"scale\": \"color\",\n            \"field\": \"Origin\"\n          },\n          \"shape\": {\n            \"value\": \"circle\"\n          },\n          \"opacity\": {\n            \"value\": 0.7\n          }\n        }\n      }\n    }]);\n\n    assert.sameDeepMembers(layers.children[1].assembleMarks(), [{\n      \"name\": \"layer_1_marks\",\n      \"type\": \"symbol\",\n      \"style\": [\"square\"],\n      \"from\": {\n        \"data\": \"layer_1_main\"\n      },\n      \"clip\": true,\n      \"encode\": {\n        \"update\": {\n          \"x\": {\n            \"scale\": \"x\",\n            \"field\": \"Horsepower\"\n          },\n          \"y\": {\n            \"scale\": \"y\",\n            \"field\": \"Miles_per_Gallon\"\n          },\n          \"fill\": {\n            \"scale\": \"color\",\n            \"field\": \"Origin\"\n          },\n          \"shape\": {\n            \"value\": \"square\"\n          },\n          \"opacity\": {\n            \"value\": 0.7\n          }\n        }\n      }\n    }]);\n  });\n\n  it('should assemble selection marks across layers', function() {\n    const child0 = layers.children[0].assembleMarks()[0];\n    const child1 = layers.children[1].assembleMarks()[0];\n\n    assert.sameDeepMembers(layers.assembleMarks(), [\n      // Background brush mark for \"brush\" selection.\n      {\n        \"name\": \"brush_brush_bg\",\n        \"type\": \"rect\",\n        \"clip\": true,\n        \"encode\": {\n          \"enter\": {\n            \"fill\": {\"value\": \"#333\"},\n            \"fillOpacity\": {\"value\": 0.125}\n          },\n          \"update\": {\n            \"x\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_x[0]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_y[0]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"x2\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_x[1]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y2\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_y[1]\"\n              },\n              {\n                \"value\": 0\n              }\n            ]\n          }\n        }\n      },\n      // Layer marks\n      {...child0, clip: true}, {...child1, clip: true},\n      // Foreground brush mark for \"brush\" selection.\n      {\n        \"name\": \"brush_brush\",\n        \"type\": \"rect\",\n        \"clip\": true,\n        \"encode\": {\n          \"enter\": {\n            \"fill\": {\"value\": \"transparent\"}\n          },\n          \"update\": {\n            \"stroke\": [\n              {\n                \"test\": \"brush_x[0] !== brush_x[1] && brush_y[0] !== brush_y[1]\",\n                \"value\": \"white\"\n              },\n              {\"value\": null}\n            ],\n            \"x\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_x[0]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_y[0]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"x2\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_x[1]\"\n              },\n              {\n                \"value\": 0\n              }\n            ],\n            \"y2\": [\n              {\n                \"test\": \"data(\\\"brush_store\\\").length && data(\\\"brush_store\\\")[0].unit === \\\"layer_0\\\"\",\n                \"signal\": \"brush_y[1]\"\n              },\n              {\n                \"value\": 0\n              }\n            ]\n          }\n        }\n      }\n    ]);\n  });\n});\n"]}