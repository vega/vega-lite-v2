{"version":3,"file":"parse.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/parse.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\n\nimport {assert} from 'chai';\nimport {selector as parseSelector} from 'vega-event-selector';\nimport * as selection from '../../../src/compile/selection/selection';\nimport {keys} from '../../../src/util';\nimport {parseUnitModel} from '../../util';\n\ndescribe('Selection', function() {\n  const model = parseUnitModel({\n    \"mark\": \"circle\",\n    \"encoding\": {\n      \"x\": {\"field\": \"Horsepower\",\"type\": \"quantitative\"},\n      \"y\": {\"field\": \"Miles_per_Gallon\",\"type\": \"quantitative\"},\n      \"color\": {\"field\": \"Origin\", \"type\": \"nominal\"}\n    }\n  });\n\n  it('parses default selection definitions', function() {\n    const component = selection.parseUnitSelection(model, {\n      \"one\": {\"type\": \"single\"},\n      \"two\": {\"type\": \"multi\"},\n      \"three\": {\"type\": \"interval\"}\n    });\n\n    assert.sameMembers(keys(component), ['one', 'two', 'three']);\n\n    assert.equal(component.one.name, 'one');\n    assert.equal(component.one.type, 'single');\n    assert.sameDeepMembers(component['one'].project, [{field: '_vgsid_', channel: null}]);\n    assert.sameDeepMembers(component['one'].events, parseSelector('click', 'scope'));\n\n    assert.equal(component.two.name, 'two');\n    assert.equal(component.two.type, 'multi');\n    assert.equal(component.two.toggle, 'event.shiftKey');\n    assert.sameDeepMembers(component['two'].project, [{field: '_vgsid_', channel: null}]);\n    assert.sameDeepMembers(component['two'].events, parseSelector('click', 'scope'));\n\n    assert.equal(component.three.name, 'three');\n    assert.equal(component.three.type, 'interval');\n    assert.equal(component.three.translate, '[mousedown, window:mouseup] > window:mousemove!');\n    assert.equal(component.three.zoom, 'wheel!');\n    assert.sameDeepMembers<selection.ProjectComponent>(component['three'].project, [{field: 'Horsepower', channel: 'x'}, {field: 'Miles_per_Gallon', channel: 'y'}]);\n    assert.sameDeepMembers(component['three'].events, parseSelector('[mousedown, window:mouseup] > window:mousemove!', 'scope'));\n  });\n\n  it('supports inline default overrides', function() {\n    const component = selection.parseUnitSelection(model, {\n      \"one\": {\n        \"type\": \"single\",\n        \"on\": \"dblclick\", \"fields\": [\"Cylinders\"]\n      },\n      \"two\": {\n        \"type\": \"multi\",\n        \"on\": \"mouseover\", \"toggle\": \"event.ctrlKey\", \"encodings\": [\"color\"]\n      },\n      \"three\": {\n        \"type\": \"interval\",\n        \"on\": \"[mousedown[!event.shiftKey], mouseup] > mousemove\",\n        \"encodings\": [\"y\"], \"translate\": false, \"zoom\": \"wheel[event.altKey]\"\n      }\n    });\n\n    assert.sameMembers(keys(component), ['one', 'two', 'three']);\n\n    assert.equal(component.one.name, 'one');\n    assert.equal(component.one.type, 'single');\n    assert.sameDeepMembers(component['one'].project, [{field: 'Cylinders', channel: null}]);\n    assert.sameDeepMembers(component['one'].events, parseSelector('dblclick', 'scope'));\n\n    assert.equal(component.two.name, 'two');\n    assert.equal(component.two.type, 'multi');\n    assert.equal(component.two.toggle, 'event.ctrlKey');\n    assert.sameDeepMembers<selection.ProjectComponent>(component['two'].project, [{field: 'Origin', channel: 'color'}]);\n    assert.sameDeepMembers(component['two'].events, parseSelector('mouseover', 'scope'));\n\n    assert.equal(component.three.name, 'three');\n    assert.equal(component.three.type, 'interval');\n    assert.equal(component.three.translate, false);\n    assert.equal(component.three.zoom, 'wheel[event.altKey]');\n    assert.sameDeepMembers<selection.ProjectComponent>(component['three'].project, [{field: 'Miles_per_Gallon', channel: 'y'}]);\n    assert.sameDeepMembers(component['three'].events, parseSelector('[mousedown[!event.shiftKey], mouseup] > mousemove', 'scope'));\n  });\n\n  it('respects selection configs', function() {\n    model.config.selection = {\n      single: {on: 'dblclick', fields: ['Cylinders']},\n      multi: {on: 'mouseover', encodings: ['color'], toggle: 'event.ctrlKey'},\n      interval: {\n        on: '[mousedown[!event.shiftKey], mouseup] > mousemove',\n        encodings: ['y'],\n        zoom: 'wheel[event.altKey]'\n      }\n    };\n\n    const component = selection.parseUnitSelection(model, {\n      \"one\": {\"type\": \"single\"},\n      \"two\": {\"type\": \"multi\"},\n      \"three\": {\"type\": \"interval\"}\n    });\n\n    assert.sameMembers(keys(component), ['one', 'two', 'three']);\n\n    assert.equal(component.one.name, 'one');\n    assert.equal(component.one.type, 'single');\n    assert.sameDeepMembers(component['one'].project, [{field: 'Cylinders', channel: null}]);\n    assert.sameDeepMembers(component['one'].events, parseSelector('dblclick', 'scope'));\n\n    assert.equal(component.two.name, 'two');\n    assert.equal(component.two.type, 'multi');\n    assert.equal(component.two.toggle, 'event.ctrlKey');\n    assert.sameDeepMembers<selection.ProjectComponent>(component['two'].project, [{field: 'Origin', channel: 'color'}]);\n    assert.sameDeepMembers(component['two'].events, parseSelector('mouseover', 'scope'));\n\n    assert.equal(component.three.name, 'three');\n    assert.equal(component.three.type, 'interval');\n    assert(!component.three.translate);\n    assert.equal(component.three.zoom, 'wheel[event.altKey]');\n    assert.sameDeepMembers<selection.ProjectComponent>(component['three'].project, [{field: 'Miles_per_Gallon', channel: 'y'}]);\n    assert.sameDeepMembers(component['three'].events, parseSelector('[mousedown[!event.shiftKey], mouseup] > mousemove', 'scope'));\n  });\n});\n"]}