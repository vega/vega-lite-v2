{"version":3,"file":"resolve.test.js","sourceRoot":"","sources":["../../../test/compile/resolve.test.ts"],"names":[],"mappings":"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","sourcesContent":["import {assert} from 'chai';\nimport {defaultScaleResolve, parseGuideResolve} from '../../src/compile/resolve';\nimport * as log from '../../src/log';\nimport {parseConcatModel, parseFacetModel, parseLayerModel, parseRepeatModel} from '../util';\n\ndescribe('compile/resolve', () => {\n  describe('defaultScaleResolve', () => {\n    it('shares scales for layer model by default.', () => {\n      const model = parseLayerModel({\n        layer: []\n      });\n      assert.equal(defaultScaleResolve('x', model), 'shared');\n    });\n\n    it('shares scales for facet model by default.', () => {\n      const model = parseFacetModel({\n        facet: {\n          row: {field: 'a', type: 'nominal'}\n        },\n        spec: {mark: 'point', encoding: {}}\n      });\n      assert.equal(defaultScaleResolve('x', model), 'shared');\n    });\n\n    it('separates xy scales for concat model by default.', () => {\n      const model = parseConcatModel({\n        hconcat: []\n      });\n      assert.equal(defaultScaleResolve('x', model), 'independent');\n    });\n\n    it('shares non-xy scales for concat model by default.', () => {\n      const model = parseConcatModel({\n        hconcat: []\n      });\n      assert.equal(defaultScaleResolve('color', model), 'shared');\n    });\n\n    it('separates xy scales for repeat model by default.', () => {\n      const model = parseRepeatModel({\n        repeat: {\n          row: ['a', 'b']\n        },\n        spec: {\n          mark: 'point',\n          encoding: {\n            x: {field: {repeat: 'row'}, type: 'quantitative'},\n            color: {field: 'color', type: 'quantitative'}\n          }\n        }\n      });\n      assert.equal(defaultScaleResolve('x', model), 'independent');\n    });\n\n    it('shares non-xy scales for repeat model by default.', () => {\n      const model = parseRepeatModel({\n        repeat: {\n          row: ['a', 'b']\n        },\n        spec: {\n          mark: 'point',\n          encoding: {\n            x: {field: {repeat: 'row'}, type: 'quantitative'},\n            color: {field: 'color', type: 'quantitative'}\n          }\n        }\n      });\n      assert.equal(defaultScaleResolve('color', model), 'shared');\n    });\n  });\n\n  describe('parseGuideResolve', () => {\n    it('shares axis for a shared scale by default', () => {\n      const axisResolve = parseGuideResolve({\n        scale: {x: 'shared'},\n        axis: {}\n      }, 'x');\n      assert.equal(axisResolve, 'shared');\n    });\n\n    it('separates axis for a shared scale if specified', () => {\n      const axisResolve = parseGuideResolve({\n        scale: {x: 'shared'},\n        axis: {x: 'independent'}\n      }, 'x');\n      assert.equal(axisResolve, 'independent');\n    });\n\n    it('separates legend for a shared scale if specified', () => {\n      const legendResolve = parseGuideResolve({\n        scale: {color: 'shared'},\n        legend: {color: 'independent'}\n      }, 'color');\n      assert.equal(legendResolve, 'independent');\n    });\n\n    it('separates axis for an independent scale by default', () => {\n      const axisResolve = parseGuideResolve({\n        scale: {x: 'independent'},\n        axis: {}\n      }, 'x');\n      assert.equal(axisResolve, 'independent');\n    });\n\n    it('separates axis for an independent scale even \"shared\" is specified and throw warning', log.wrap((localLogger) => {\n      const axisResolve = parseGuideResolve({\n        scale: {x: 'independent'},\n        axis: {x: 'shared'}\n      }, 'x');\n      assert.equal(axisResolve, 'independent');\n      assert.equal(localLogger.warns[0], log.message.independentScaleMeansIndependentGuide('x'));\n    }));\n  });\n});\n"]}